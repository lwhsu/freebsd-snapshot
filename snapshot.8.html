<!-- manual page source format generated by PolyglotMan v3.0.8+X.Org, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>snapshot(8) manual page</title>
</head>
<body bgcolor='#efefef' text='black' link='blue' vlink='#551A8B' alink='red'>
<a href='#toc'>Table of Contents</a><p>

<h2><a name='sect0' href='#toc0'>Name</a></h2>

<p>
<b>snapshot </b>-- UFS/ZFS snapshot management utility

<p>
<h2><a name='sect1' href='#toc1'><b>Synopsis</b></a></h2>

<p>
<b>snapshot </b>[<i>options</i>] [<i>command</i>] [<i>arguments</i>]

<p>
<h2><a name='sect2' href='#toc2'><b>Description</b></a></h2>

<p>
The <b>snapshot </b>command is a convenience frontend to <a href='mount.8.html'>mount(8)</a>
 and
<a href='mdconfig.8.html'>mdconfig(8)</a>
 for the management of UFS/ZFS snapshots. It is also the
underlying tool used in the periodic snapshot scheduler
<a href='periodic-snapshot.8.html'>periodic-snapshot(8)</a>
 and the mounting/unmouning command in the <a href='amd.8.html'>amd(8)</a>
 map
<i>/etc/amd.map.snap</i>. It provides the making, expiring, visiting, mounting
and unmounting of filesystem snapshots.

<p><p>
The following global options are available:

<p>
<dl>

<dt><b>-v </dt></dt>
<dd>     </b>Display verbose messages showing the essential system commands
involved in the operation.

<p></dd>

<dt><b>-h </dt></dt>
<dd>     </b>Display a short usage help message and exit.

<p></dd>

<dt><b>-d </b><i>subdir</dt></dt>
<dd>
Set the subdirectory on filesystems under which snapshots are
placed. The default is the conventional <i>.snap</i> subdirectory
<a href='dump.8.html'>dump(8)</a>
 uses, too.

<p></dd>
</dl>
<p>
The following commands are available:

<p><p>
<b>snapshot list </b>[<i>fs</i> <i>...</i>]<br>

List all existing snapshots on all filesystems or just the particular
filesystems specified by <i>fs</i>. The output shows both
actual disk-space user usage ("User", User%") and the disk-space
snapshot usage ("Snap", Snap%").

<p><p>
<b>snapshot make </b>[<b>-g </b><i>max-generations] fs:tag[.generation]
Makes a new snapshot generation named <i>tag</i> on filesystem <i>fs</i>,
located in the file <i>fs</i>/<i>subdir</i>/<i>tag</i>.<i>generation</i>. If the <i>generation</i>
part is omitted, generation 0 is used. All older generations
(with numbers greater than <i>generation</i>) are rotated and all obsoleted
generations (with numbers greater or equal to
<i>max-generations</i>) are removed. Keep in mind that a maximum total
number of 20 snapshots can be created on a UFS filesystem only.
A <i>max-generations</i> number of 0 effectively deletes all snapshots
on filesystem <i>fs</i> of name <i>tag</i> only.

<p><p>
<b>snapshot mount </b>[<b>-o </b><i>mount-option] fs:tag[.generation] dir
Mounts the <i>fs</i> snapshot <i>tag</i>.<i>generation</i> (or <i>tag</i>.0 if <i>generation</i> <i>is</i>
<i>omitted)</i> under <i>dir</i> by attaching the snapshot file to the next
free <a href='md.4.html'>md(4)</a>
 device and mounting this device read-only onto the
target directory. If options <b>-o </b>are specified, they are passedthrough
to <a href='mount.8.html'>mount(8)</a>
.

<p><p>
<b>snapshot umount </b><i>dir<br>

Unmounts a snapshot by umounting the <a href='md.4.html'>md(4)</a>
 device from dir, deattaching
the snapshot file from the corresponding <a href='md.4.html'>md(4)</a>
 device and
deleting the device.

<p><p>
<b>snapshot visit </b><i>fs:tag[.generation]<br>

This is just a convenience command which mounts the specified
filesystem on <i>/mnt</i>, temporarily changes to <i>/mnt,</i> starts an interactive
shell there for inspecting the snapshot content, and upon
exit from the shell immediately unmounts the snapshot again.

<p>
<h2><a name='sect3' href='#toc3'><b>Example</b></a></h2>

<p>
The following sample session illustrates the making, rotation, mounting,
unmounting and removal of snapshots:

<p><p>
root# snapshot list /var<br>


<dl>

<dt>Filesystem </dt></dt>
<dd>         User User%     Snap Snap% Snapshot
root# snapshot make -g4 /var:test
root# snapshot list /var
</dd>

<dt>Filesystem </dt></dt>
<dd>         User User%     Snap Snap% Snapshot
</dd>

<dt>/var </dt></dt>
<dd>             1172MB 14.8%      4MB    0.1% test.0
root# snapshot make -g4 /var:test
root# snapshot list /var
</dd>

<dt>Filesystem </dt></dt>
<dd>         User User%     Snap Snap% Snapshot
</dd>

<dt>/var </dt></dt>
<dd>             1176MB 14.8%      4MB    0.1% test.0
</dd>

<dt>/var </dt></dt>
<dd>             1176MB 14.8%      4MB    0.1% test.1
root# snapshot make -g4 /var:test
root# snapshot list /var
</dd>

<dt>Filesystem </dt></dt>
<dd>         User User%     Snap Snap% Snapshot
</dd>

<dt>/var </dt></dt>
<dd>             1181MB 14.9%      4MB    0.1% test.0
</dd>

<dt>/var </dt></dt>
<dd>             1181MB 14.9%      4MB    0.1% test.1
</dd>

<dt>/var </dt></dt>
<dd>             1181MB 14.9%      4MB    0.1% test.2
root# snapshot make -g4 /var:test
root# snapshot list /var
</dd>

<dt>Filesystem </dt></dt>
<dd>         User User%     Snap Snap% Snapshot
</dd>

<dt>/var </dt></dt>
<dd>             1186MB 15.0%      4MB    0.1% test.0
</dd>

<dt>/var </dt></dt>
<dd>             1186MB 15.0%      4MB    0.1% test.1
</dd>

<dt>/var </dt></dt>
<dd>             1186MB 15.0%      4MB    0.1% test.2
</dd>

<dt>/var </dt></dt>
<dd>             1186MB 15.0%      4MB    0.1% test.3
root# snapshot make -g4 /var:test
root# snapshot list /var
</dd>

<dt>Filesystem </dt></dt>
<dd>         User User%     Snap Snap% Snapshot
</dd>

<dt>/var </dt></dt>
<dd>             1186MB 15.0%      4MB    0.1% test.0
</dd>

<dt>/var </dt></dt>
<dd>             1186MB 15.0%      4MB    0.1% test.1
</dd>

<dt>/var </dt></dt>
<dd>             1186MB 15.0%      4MB    0.1% test.2
</dd>

<dt>/var </dt></dt>
<dd>             1186MB 15.0%      4MB    0.1% test.3
root# snapshot mount /var:test.2 /mnt
root# ls /mnt
account    cron       heimdal    mail       opkg       spool
</dd>

<dt>at </dt></dt>
<dd>        db         lib        msgs     preserve tmp
backups    empty      log        named      run       yp
root# snapshot umount /mnt
root# snapshot make -g0 /var:test
root# snapshot list /var
</dd>

<dt>Filesystem </dt></dt>
<dd>         User User%     Snap Snap% Snapshot
root# _

<p></dd>
</dl>
<p>
By using an <a href='amd.8.html'>amd(8)</a>
 map <i>/etc/amd.map.snap</i> containing

<p><p>
/defaults type:=program<br>


<dl>

<dt>* </dt></dt>
<dd>        mount:="/usr/sbin/snapshot snapshot mount /${key} ${fs}";\
unmount:="/usr/sbin/snapshot snapshot umount ${fs}"

<p></dd>
</dl>
<p>
and a <i>/etc/rc.conf</i> configuration of

<p><p>
amd_enable="YES"<br>

amd_flags="-a /.am -c 1800 -w 60 -l syslog /snap /etc/amd.map.snap"

<p><p>
even non-privileged users can access arbitrary snapshots
<i>fs</i>:<i>tag</i>[<i>generation</i>] by just accessing <i>/snap/fs</i>:<i>tag</i>[<i>generation</i>]. For
instance, if a snapshot <i>hourly.2</i> exists on filesystem <i>/var</i> one can then
access an old state of file <i>/var/tmp/foo.txt</i> by simply accessing the path
<i>/snap/var:hourly.2/tmp/foo.txt</i>.

<p>
<h2><a name='sect4' href='#toc4'><b>See Also</b></a></h2>

<p>
<a href='mount.8.html'>mount(8)</a>
, <a href='mdconfig.8.html'>mdconfig(8)</a>
, <a href='md.4.html'>md(4)</a>
, <a href='periodic-snapshot.8.html'>periodic-snapshot(8)</a>
,
http://people.freebsd.org/~rse/snapshot/.

<p>
<h2><a name='sect5' href='#toc5'><b>History</b></a></h2>

<p>
The <b>snapshot </b>utility first appeared in FreeBSD.

<p>
<h2><a name='sect6' href='#toc6'><b>Authors</b></a></h2>

<p>
Ralf S. Engelschall &lt;rse@FreeBSD.org&gt;
<p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Synopsis</a></li>
<li><a name='toc2' href='#sect2'>Description</a></li>
<li><a name='toc3' href='#sect3'>Example</a></li>
<li><a name='toc4' href='#sect4'>See Also</a></li>
<li><a name='toc5' href='#sect5'>History</a></li>
<li><a name='toc6' href='#sect6'>Authors</a></li>
</ul>
</body>
</html>
